# Проектная работа "Веб-ларек"
<a id="anchor"></a>
***

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
***
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
### Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении
***
Товар (продукт)

```
interface IProduct {
	id: string;
	title: string;
	category: string;
	description: string;
	image: string;
	price: number | null;
}
```

Каталог товаров выводимых на основную страницу 

```
interface IProductsData {
	products: TProductsPage[];
	getProduct(id: string): IProduct | undefined;
}
```

Данные для оформления заказа

```
interface IOrderInfo {
    email: string;
    phone: string;
    address: string;
	payment: TPayment;
}
```

Данные и методы заказа

```
interface IOrderData {
	products: TProductsOrder[];
	total: number | null;
	addProduct(item: TProductsOrder): void;
	checkProduct(id: string): boolean;
	deleteProduct(id: string): void;
	getQuantity(): number;
	getTotal(): number;
}
```

Заказ

```
interface IOrder extends IOrderInfo, IOrderData {
	clearOrder(): void;
}
```

Выбор формы оплаты 

```
type TPayment = 'online' | 'receipt';
```

Списки товаров выводимых на основную страницу и в составе заказа 

```
type TProductsPage = Omit<IProduct, 'description'>;
type TProductsOrder = Pick<IProduct, 'id' |'title' | 'price'>;
```

Данные заказа в форме на первом, втором и заключительном этапе

```
type TOrderPaymentAddress = Pick<IOrderInfo, 'payment' | 'address'>;
type TOrderEmailPhone = Pick<IOrderInfo, 'email' | 'phone'>;
type TOrderCheckout = Pick<IOrder, 'total'>;
```

## Описание проекта
***
Проект "Веб-ларек" реализует пример функционально упрощенного сервиса для покупок
товаров - интернет-магазина.\
В магазине представлены товары для веб-разработчиков.\
Пользователь может посмотреть каталог товаров, детальную информацию о товаре, 
добавить товар в корзину и сделать заказ.\
Проект реализован на TypeScript и представляет собой SPA (Single Page Application)
с использованием API для получения данных о товарах.

## Архитектура приложения
***
Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter):
* __Model__ - слой данных, отвечает за хранение и изменение данных
* __View__ - слой представления, отвечает за отображение данных на странице,
* __Presenter__ - презентер, отвечает за связь представления и данных.

### Базовый код
***


#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый 
адрес сервера и опциональный объект с заголовками запросов.

Поля:
* `readonly baseUrl: string` - базовый url для api
* `protected options: RequestInit` - объект с настройками для формирования запроса

Конструктор принимает параметры базового url для api и объект с настройками для формирования запроса

Методы:
* `protected handleResponse(response: Response): Promise<object>` - обрабатывает ответа с сервера. Если ответ с сервера пришел, то возвращается его в формате json, в противном случае формирует ошибку
* `get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
* `post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.


#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.

Поля:
* `_events: Map<EventName, Set<Subscriber>>` - хранит события в виде Map, где ключом является строка или регулярное выражение, а значением сет коллбэков

Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
* `on<T extends object>(event: EventName, callback: (data: T) => void): void` - Установить обработчик на событие
* `emit<T extends object>(event: string, data?: T): void` - Инициировать событие с данными
* `trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие


### Слой данных
***


#### Класс Product
Класс отвечает за хранение и логику работы с данными товаров.\

Данные:
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.
- `protected _products: IProduct[]` - массив объектов товаров

Конструктор класса принимает инстант брокера событий

Методы:
- `getProduct(id: string): IProduct` - возвращает товар по его id
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса


#### Класс Order
Класс отвечает за хранение и логику работы с данными заказа.\

Данные:
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.
- `protected _products: TProductsOrder[]` - массив объектов товаров добавленных в заказ
- `protected _total: number` - суммарная стоимость товаров в заказе
- `protected _email: string` - email заказчика
- `protected _phone: string` - номер телефона заказчика
- `protected _address: string` - адрес заказчика
- `protected _payment: TPayment` - способ оплаты

Конструктор класса принимает инстант брокера событий

Методы:
- `addProduct(item: TProductsOrder): void` - добавляет товар в заказ
- `checkProduct(id: string): boolean` - проверяет наличие товара в заказе
- `deleteProduct(id: string): void` - удаляет товар из заказа
- `getQuantity(): number` - возвращает количество товаров в заказе
- `getTotal(): number` - возвращает суммарную стоимость заказа
- `clearOrder(): void` - очищает данные заказа (после оформления)
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса


### Слой представления
***


#### Класс BaseView
Абстрактный класс, является базовым родительским классом для ВСЕХ классов слоя представления.

Поля:
- `protected _container` - DOM элемент компонента
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Конструктор принимает DOM элемент компонента и экземпляр класса `EventEmitter`

Методы:
- render(): HTMLElement - возвращает html-элемент по переданным данным


#### Класс CardView
Абстрактный класс, в который вынесены общие поля всех разновидностей карточек
имеющихся в приложении:
- CardCatalog, карточка в каталоге на главной странице;
- CardDetail, карточка с детальным описанием товара в модальном окне;
- CardOrder, карточка товара в заказе

Поля:
- `protected _id` - id карточки товара
- `protected _title` - html-элемент, отвечающий за отображение имени товара
- `protected _price` - html элемент, отвечающий за отображение цены товара

Конструктор принимает параметры базового класса BaseView
 
Методы:
- сеттеры и геттеры для сохранения и получения данных из полей класса


#### Класс CardCatalogView
Расширяет класс Card. Служит для отображения карточки в каталоге на главной странице.

Поля:
- `protected _category` - html-элемент, отвечающий за отображение категории товара
- `protected _image` - html-элемент, отвечающий за отображение изображения товара

Конструктор принимает параметры базового класса BaseView

Методы:
- сеттеры и геттеры для сохранения и получения данных из полей класса


#### Класс CardDetailView
Расширяет класс Card. Служит для отображения карточки с детальным описанием товара в модальном окне.

Поля:
- `protected _description` - html-элемент, отвечающий за отображение описания товара
- `buttonOrder` - кнопка для добавления товара в заказ (или удаления из заказа)

Конструктор принимает параметры базового класса BaseView

Методы:
- сеттеры и геттеры для сохранения и получения данных из полей класса


#### Класс CardOrderView
Расширяет класс Card. Служит для отображения карточки товара в заказе.

Поля:
- `index` - html-элемент, отвечающий за отображение порядкового номера в корзине
- `buttonDelete` - кнопка для удаления товара из заказа (иконка корзины)

Конструктор принимает параметры базового класса BaseView

Методы:
- сеттеры и геттеры для сохранения и получения данных из полей класса


#### Класс CatalogView
Расширяет класс BaseView. Служит для отображения блока с карточками товаров на главной странице. 

Поля:
- `protected _catalog` - контейнер для отображения карточек товаров

Конструктор принимает параметры базового класса BaseView

Методы:
- `set catalog(cards: HTMLElement[])` - сеттер записывающий карточки в каталог


#### Класс BasketView
Расширяет класс BaseView. Служит для отображения корзины с заказом в шапке сайта 

Поля:
- `protected buttonBasket` - кнопка в виде корзины, открывающая модальное окно с заказом
- `protected _counter` - html-элемент, показывает количество товаров в заказе

Конструктор принимает параметры базового класса BaseView

Методы:
- `set counter(value: string)` - сеттер, записывает количество товаров в заказе


#### Класс OrderView
Расширяет класс BaseView. Служит для отображения заказа с товарами. 

Поля:
- `protected _orderList` - html-элемент, список товаров в заказе
- `protected _total` - html-элемент, общая стоимость товаров
- `protected buttonPlaceOrder` - кнопка "Оформить" (заказ)

Конструктор принимает параметры базового класса BaseView

Методы:
- `set cardsList(cards: HTMLElement[])` - сеттер записывающий список товаров в заказ
- `set total(value: number)` - сеттер устанавливающий общую стоимость товаров


#### Класс ModalView
Расширяет класс BaseView. Реализует модальное окно. 
Устанавливает слушатели на клик в оверлей и кнопку-крестик для закрытия модального окна.   

Поля:
- `protected _content` - html-элемент, содержимое модального окна
- `protected buttonClose` - кнопка закрытия модального окна

Конструктор принимает параметры базового класса BaseView

Методы:
- `set content(value: HTMLElement): void` - сеттер устанавливающий содержимое модального окна
- `open(): void` - метод для открытия модального окна
- `close(): void` - метод для закрытия модального окна


#### Класс FormView
Абстрактный класс, в который вынесены общие поля и методы всех разновидностей форм
имеющихся в приложении:
- FormDelivery, форма для заполнения метода оплаты и адреса доставки;
- FormContacts, форма для заполнения Email и номера телефона

Поля:
- `protected _form: HTMLFormElement` - html-элемент формы
- `protected inputs: HTMLInputElement[]` - список input элементов формы
- `protected submitButton: HTMLButtonElement` - кнопка подтверждения
- `protected errorMessage: HTMLSpanElement` - html-элемент для вывода сообщений об ошибках

Конструктор принимает параметры базового класса BaseView

Методы:
- `set valid(isValid: boolean): void` - изменяет активность кнопки подтверждения
- `get valid(): boolean` - получение статуса валидности
- `set errorMessage(value: string)` - установка текста сообщения об ошибке
- `clear(): void` - очистка формы


#### Класс FormDelivery
Расширяет класс FormView. 
Реализует форму для заполнения метода оплаты и адреса доставки

Поля:
- `protected buttonPayOnline: HTMLButtonElement` - кнопка оплаты онлайн
- `protected buttonPayReceipt: HTMLButtonElement` - кнопка оплаты при получении
- `protected inputAddress: HTMLInputElement` - поле ввода адреса заказчика

Конструктор принимает параметры базового класса FormView

Методы:
- `get address(): string` - возвращает адрес заказчика
- служебные методы будут задокументированы в процессе реализации


#### Класс FormContacts
Расширяет класс FormView. 
Реализует форму для заполнения Email и номера телефона

Поля:
- `protected inputEmail: HTMLInputElement` - поле ввода Email заказчика
- `protected inputPhone: HTMLInputElement` - поле ввода номера телефона заказчика

Конструктор принимает параметры базового класса FormView

Методы:
- `get email(): string` - возвращает Email заказчика
- `get phone(): string` - возвращает номер телефона заказчика


#### Класс CheckoutView
Расширяет класс BaseView. 
Реализует уведомление об окончании оформления заказа

Поля:
- `protected _total` - html-элемент, выводит сумму списанных средств
- `protected buttonCheckout: HTMLButtonElement` - кнопка "За новыми покупками"

Конструктор принимает параметры базового класса BaseView

Методы:
- `set total(value: string): void` - устанавливает сумму списанных средств


### Слой коммуникации
***

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.


## Взаимодействие компонентов
***
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.


### *Список всех событий, которые могут генерироваться в системе:*

#### *События изменения данных (генерируются классами моделями данных)*
- `products:changed` - изменение массива товаров (загрузка списка с сервера)
- `order:changed` - изменение массива заказа (добавление и удаление товаров в заказ)
- `checkout:changed` - окончание оформления заказа

#### *События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна
- `detail:open` - открытие модального окна c детальной информацией о товаре
- `order:open` - открытие модального окна c заказом
- `order:add` - добавление товара в заказ
- `order:delete` - удаление товара из заказа
- `form:open` - открытие модального окна с формой доставки
- `form-delivery:input` - действия заказчика с полями формы доставки
- `form-delivery:submit` - успешная отправка формы доставки
- `form-contacts:input` - действия заказчика с полями формы контактных данных
- `form-contacts:submit` - успешная отправка формы контактных данных




### Ссылка на репозитарий:
https://github.com/svk-2020/web-larek-frontend.git



### Автор проекта:

[Станислав Казаринов](mailto:skazarinov@mail.ru "Написать автору")

[__В начало__](#anchor) :point_up: